<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒªãƒã‚¸ãƒˆãƒªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©</title>
  <style>
    /* åŸºæœ¬ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    ul {
      list-style: none;
      padding-left: 20px;
    }
    li {
      line-height: 1.5;
    }
    .folder > .folder-name {
      cursor: pointer;
      font-weight: bold;
    }
    .folder::before {
      content: "ğŸ“ ";
    }
    .file a::before {
      content: "ğŸ“„ ";
    }
  </style>
</head>
<body>
  <h1>ãƒªãƒã‚¸ãƒˆãƒªã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©</h1>
  <div id="tree">èª­ã¿è¾¼ã¿ä¸­...</div>

  <script>
    // --- è¨­å®šéƒ¨åˆ† --- 
    // ä»¥ä¸‹ã®å¤‰æ•°ã‚’ã‚ãªãŸã®ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„
    const owner = "yaruojson";         // GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯çµ„ç¹”å
    const repo = "yaruojson.github.io";     // ãƒªãƒã‚¸ãƒˆãƒªå
    const branch = "main";                   // å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒï¼ˆä¾‹ï¼š"main"ã¾ãŸã¯"master"ï¼‰

    // GitHub API ã‚’ä½¿ã£ã¦ãƒªãƒã‚¸ãƒˆãƒªãƒ„ãƒªãƒ¼ï¼ˆå†å¸°çš„ï¼‰ã‚’å–å¾—
    const apiUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

    // APIã‹ã‚‰å–å¾—ã—ã¦ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’ä½œæˆã™ã‚‹
    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        // data.tree ã¯å…¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ•ãƒ©ãƒƒãƒˆãªãƒªã‚¹ãƒˆ
        const tree = data.tree;

        // ãƒ•ã‚©ãƒ«ãƒ€éšå±¤æ§‹é€ ã¸å¤‰æ›ã™ã‚‹
        let treeStructure = {};
        tree.forEach(item => {
          const parts = item.path.split('/');
          let current = treeStructure;
          for (let i = 0; i < parts.length; i++) {
            const part = parts[i];
            // æœ€çµ‚è¦ç´ ãªã‚‰ã°ãƒ•ã‚¡ã‚¤ãƒ«(blob)ã¾ãŸã¯ãƒ•ã‚©ãƒ«ãƒ€(tree)ã¨ã—ã¦è¨­å®š
            if (i === parts.length - 1) {
              current[part] = { type: item.type, path: item.path };
            } else {
              if (!current[part]) {
                current[part] = { type: "tree", children: {} };
              }
              current = current[part].children;
            }
          }
        });

        // ãƒ„ãƒªãƒ¼æ§‹é€ ã‚’å…ƒã«HTMLãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
        const treeContainer = document.getElementById('tree');
        treeContainer.innerHTML = "";
        treeContainer.appendChild(createList(treeStructure));
      })
      .catch(error => {
        console.error("ãƒªãƒã‚¸ãƒˆãƒªãƒ„ãƒªãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
        document.getElementById('tree').textContent = "ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      });

    // å†å¸°çš„ã«HTMLã®ãƒªã‚¹ãƒˆï¼ˆul/liï¼‰ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
    function createList(obj) {
      const ul = document.createElement('ul');
      for (let key in obj) {
        const li = document.createElement('li');
        // ãƒ•ã‚©ãƒ«ãƒ€ã®å ´åˆ
        if (obj[key].type === "tree") {
          li.classList.add("folder");

          // ãƒ•ã‚©ãƒ«ãƒ€åã‚’ span ã§ãƒ©ãƒƒãƒ—ã—ã‚¯ãƒªãƒƒã‚¯ã§ä¸­èº«ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
          const span = document.createElement('span');
          span.textContent = key;
          span.classList.add("folder-name");
          li.appendChild(span);

          // å­è¦ç´ ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆã—ã€åˆæœŸè¡¨ç¤ºã¯å±•é–‹çŠ¶æ…‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦ "none" ã«å¤‰æ›´å¯èƒ½ï¼‰
          const childUl = createList(obj[key].children);
          li.appendChild(childUl);

          // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼šå­ãƒªã‚¹ãƒˆã®è¡¨ç¤ºåˆ‡æ›¿
          span.addEventListener('click', (event) => {
            if (childUl.style.display === "none") {
              childUl.style.display = "block";
            } else {
              childUl.style.display = "none";
            }
            event.stopPropagation();
          });
        }
        // ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
        else if (obj[key].type === "blob") {
          li.classList.add("file");
          const a = document.createElement('a');
          a.textContent = key;
          // GitHubä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤ºãƒšãƒ¼ã‚¸ã¸ãƒªãƒ³ã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦ Raw ãƒ•ã‚¡ã‚¤ãƒ«URLç­‰ã«å¤‰æ›´å¯ï¼‰
          a.href = `https://github.com/${owner}/${repo}/blob/${branch}/${obj[key].path}`;
          a.target = "_blank";
          li.appendChild(a);
        }
        ul.appendChild(li);
      }
      return ul;
    }
  </script>
</body>
</html>
